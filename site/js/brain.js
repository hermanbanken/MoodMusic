var brain=function(){function require(a){var b=require.modules[a]||require.modules[a.replace(/\.(js|coffee)$/,"")]||require.modules[a+"/index"];if(!b)throw new Error("Cannot find module '"+a+"'");return b._cached?b._cached:b()}var _browserifyRequire=require;require.paths=[],require.modules={},require.fromFile=function(a,b){var c=_browserifyRequire.resolve(a,b);return _browserifyRequire(c)},require.resolve=function(a,b){if(_browserifyRequire.modules[a+"/node_modules/"+b])return a+"/node_modules/"+b;if(!b.match(/^[\.\/]/))return b;if(b.match(/^\//))return b;var c=a.match(/^[\.\/]/)?a.replace(/[^\/]+$/,""):a;c===""&&(c=".");var d=/[^\/.]+\/\.\./g,e=/\/{2,}/g;for(var f=b;f.match(d)!=null||f.match(e)!=null;f=f.replace(d,"").replace(e,"/"));while(f.match(/^\.\.\//)){if(c==="/"||c==="")throw new Error("Couldn't resolve path'"+b+"' with respect to filename '"+a+"': "+"file can't resolve past base");f=f.replace(/^\.\.\//,""),c=c.replace(/[^\/]+\/$/,"")}var g=c.match(/\//)?c.replace(/[^\/]+$/,"")+f:f.replace(/^\.\//,c+"/");return g.replace(/\/.\//,"/")},typeof process=="undefined"&&(process={nextTick:function(a){setTimeout(a,0)},title:"browser"}),_browserifyRequire.modules.events=function(){var a={exports:{}},b=a.exports,c=".",d="events.js",e=function(a){return _browserifyRequire.fromFile("events",a)};(function(){process.EventEmitter||(process.EventEmitter=function(){});var a=b.EventEmitter=process.EventEmitter,c=Array.isArray,d=10;a.prototype.setMaxListeners=function(a){this._events.maxListeners=a},a.prototype.emit=function(a){if(a==="error")if(!this._events||!this._events.error||c(this._events.error)&&!this._events.error.length)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var b=this._events[a];if(!b)return!1;if(typeof b=="function"){switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:var d=Array.prototype.slice.call(arguments,1);b.apply(this,d)}return!0}if(c(b)){var d=Array.prototype.slice.call(arguments,1),e=b.slice();for(var f=0,g=e.length;f<g;f++)e[f].apply(this,d);return!0}return!1},a.prototype.addListener=function(a,b){if("function"!=typeof b)throw new Error("addListener only takes instances of Function");this._events||(this._events={}),this.emit("newListener",a,b);if(!this._events[a])this._events[a]=b;else if(c(this._events[a])){if(!this._events[a].warned){var e;this._events.maxListeners!==undefined?e=this._events.maxListeners:e=d,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}this._events[a].push(b)}else this._events[a]=[this._events[a],b];return this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(a,b){var c=this;c.on(a,function d(){c.removeListener(a,d),b.apply(this,arguments)});return this},a.prototype.removeListener=function(a,b){if("function"!=typeof b)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[a])return this;var d=this._events[a];if(c(d)){var e=d.indexOf(b);if(e<0)return this;d.splice(e,1),d.length==0&&delete this._events[a]}else this._events[a]===b&&delete this._events[a];return this},a.prototype.removeAllListeners=function(a){a&&this._events&&this._events[a]&&(this._events[a]=null);return this},a.prototype.listeners=function(a){this._events||(this._events={}),this._events[a]||(this._events[a]=[]),c(this._events[a])||(this._events[a]=[this._events[a]]);return this._events[a]}}).call(a.exports),_browserifyRequire.modules.events._cached=a.exports;return a.exports},[].forEach(function(a){_browserifyRequire.modules[a]=_browserifyRequire.modules.events}),_browserifyRequire.modules.fs=function(){var a={exports:{}},b=a.exports,c=".",d="fs.js",e=function(a){return _browserifyRequire.fromFile("fs",a)};(function(){}).call(a.exports),_browserifyRequire.modules.fs._cached=a.exports;return a.exports},[].forEach(function(a){_browserifyRequire.modules[a]=_browserifyRequire.modules.fs}),_browserifyRequire.modules.json_shim=function(){var module={exports:{}},exports=module.exports,__dirname=".",__filename="json_shim.js",require=function(a){return _browserifyRequire.fromFile("json_shim",a)};(function(){typeof JSON=="undefined"&&(JSON={}),function(){function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g;return e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)typeof rep[c]=="string"&&(d=rep[c],e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g;return e}}function quote(a){escapable.lastIndex=0;return escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function f(a){return a<10?"0"+a:a}"use strict",typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(b&&typeof b!="function"&&(typeof b!="object"||typeof b.length!="number"))throw new Error("JSON.stringify");return str("",{"":a})}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver=="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")})}()}).call(module.exports),_browserifyRequire.modules.json_shim._cached=module.exports;return module.exports},[].forEach(function(a){_browserifyRequire.modules[a]=_browserifyRequire.modules.json_shim}),_browserifyRequire.modules.path=function(){var a={exports:{}},b=a.exports,c=".",d="path.js",e=function(a){return _browserifyRequire.fromFile("path",a)};(function(){function a(a,b){var c=0;for(var d=a.length;d>=0;d--){var e=a[d];e=="."?a.splice(d,1):e===".."?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}var c=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;b.resolve=function(){var b="",c=!1;for(var d=arguments.length;d>=-1&&!c;d--){var e=d>=0?arguments[d]:process.cwd();if(typeof e!="string"||!e)continue;b=e+"/"+b,c=e.charAt(0)==="/"}b=a(b.split("/").filter(function(a){return!!a}),!c).join("/");return(c?"/":"")+b||"."},b.normalize=function(b){var c=b.charAt(0)==="/",d=b.slice(-1)==="/";b=a(b.split("/").filter(function(a){return!!a}),!c).join("/"),!b&&!c&&(b="."),b&&d&&(b+="/");return(c?"/":"")+b},b.join=function(){var a=Array.prototype.slice.call(arguments,0);return b.normalize(a.filter(function(a,b){return a&&typeof a=="string"}).join("/"))},b.dirname=function(a){var b=c.exec(a)[1]||"";return b?b.length===1||isWindows&&b.length<=3&&b.charAt(1)===":"?b:b.substring(0,b.length-1):"."},b.basename=function(a,b){var d=c.exec(a)[2]||"";b&&d.substr(-1*b.length)===b&&(d=d.substr(0,d.length-b.length));return d},b.extname=function(a){return c.exec(a)[3]||""}}).call(a.exports),_browserifyRequire.modules.path._cached=a.exports;return a.exports},[].forEach(function(a){_browserifyRequire.modules[a]=_browserifyRequire.modules.path}),_browserifyRequire.modules.underscore=function(){var a={exports:{}},b=a.exports,c="underscore",d="underscore/underscore",e=function(a){return _browserifyRequire.fromFile("underscore",a)};(function(){(function(){var b=this,c=b._,d={},e=Array.prototype,f=Object.prototype,g=Function.prototype,h=e.slice,i=e.unshift,j=f.toString,k=f.hasOwnProperty,l=e.forEach,m=e.map,n=e.reduce,o=e.reduceRight,p=e.filter,q=e.every,r=e.some,s=e.indexOf,t=e.lastIndexOf,u=Array.isArray,v=Object.keys,w=g.bind,x=function(a){return new C(a)};typeof a!="undefined"&&a.exports?(a.exports=x,x._=x):b._=x,x.VERSION="1.1.6";var y=x.each=x.forEach=function(a,b,c){if(a!=null)if(l&&a.forEach===l)a.forEach(b,c);else if(x.isNumber(a.length)){for(var e=0,f=a.length;e<f;e++)if(b.call(c,a[e],e,a)===d)return}else for(var g in a)if(k.call(a,g)&&b.call(c,a[g],g,a)===d)return};x.map=function(a,b,c){var d=[];if(a==null)return d;if(m&&a.map===m)return a.map(b,c);y(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)});return d},x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=c!==void 0;a==null&&(a=[]);if(n&&a.reduce===n){d&&(b=x.bind(b,d));return e?a.reduce(b,c):a.reduce(b)}y(a,function(a,f,g){!e&&f===0?(c=a,e=!0):c=b.call(d,c,a,f,g)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},x.reduceRight=x.foldr=function(a,b,c,d){a==null&&(a=[]);if(o&&a.reduceRight===o){d&&(b=x.bind(b,d));return c!==void 0?a.reduceRight(b,c):a.reduceRight(b)}var e=(x.isArray(a)?a.slice():x.toArray(a)).reverse();return x.reduce(e,b,c,d)},x.find=x.detect=function(a,b,c){var d;z(a,function(a,e,f){if(b.call(c,a,e,f)){d=a;return!0}});return d},x.filter=x.select=function(a,b,c){var d=[];if(a==null)return d;if(p&&a.filter===p)return a.filter(b,c);y(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)});return d},x.reject=function(a,b,c){var d=[];if(a==null)return d;y(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)});return d},x.every=x.all=function(a,b,c){var e=!0;if(a==null)return e;if(q&&a.every===q)return a.every(b,c);y(a,function(a,f,g){if(!(e=e&&b.call(c,a,f,g)))return d});return e};var z=x.some=x.any=function(a,b,c){b||(b=x.identity);var e=!1;if(a==null)return e;if(r&&a.some===r)return a.some(b,c);y(a,function(a,f,g){if(e=b.call(c,a,f,g))return d});return e};x.include=x.contains=function(a,b){var c=!1;if(a==null)return c;if(s&&a.indexOf===s)return a.indexOf(b)!=-1;z(a,function(a){if(c=a===b)return!0});return c},x.invoke=function(a,b){var c=h.call(arguments,2);return x.map(a,function(a){return(b.call?b||a:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,function(a){return a[b]})},x.max=function(a,b,c){if(!b&&x.isArray(a))return Math.max.apply(Math,a);var d={computed:-Infinity};y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})});return d.value},x.min=function(a,b,c){if(!b&&x.isArray(a))return Math.min.apply(Math,a);var d={computed:Infinity};y(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})});return d.value},x.sortBy=function(a,b,c){return x.pluck(x.map(a,function(a,d,e){return{value:a,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),"value")},x.sortedIndex=function(a,b,c){c||(c=x.identity);var d=0,e=a.length;while(d<e){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},x.toArray=function(a){if(!a)return[];if(a.toArray)return a.toArray();if(x.isArray(a))return a;if(x.isArguments(a))return h.call(a);return x.values(a)},x.size=function(a){return x.toArray(a).length},x.first=x.head=function(a,b,c){return b!=null&&!c?h.call(a,0,b):a[0]},x.rest=x.tail=function(a,b,c){return h.call(a,b==null||c?1:b)},x.last=function(a){return a[a.length-1]},x.compact=function(a){return x.filter(a,function(a){return!!a})},x.flatten=function(a){return x.reduce(a,function(a,b){if(x.isArray(b))return a.concat(x.flatten(b));a[a.length]=b;return a},[])},x.without=function(a){var b=h.call(arguments,1);return x.filter(a,function(a){return!x.include(b,a)})},x.uniq=x.unique=function(a,b){return x.reduce(a,function(a,c,d){if(0==d||(b===!0?x.last(a)!=c:!x.include(a,c)))a[a.length]=c;return a},[])},x.intersect=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.indexOf(b,a)>=0})})},x.zip=function(){var a=h.call(arguments),b=x.max(x.pluck(a,"length")),c=Array(b);for(var d=0;d<b;d++)c[d]=x.pluck(a,""+d);return c},x.indexOf=function(a,b,c){if(a==null)return-1;var d,e;if(c){d=x.sortedIndex(a,b);return a[d]===b?d:-1}if(s&&a.indexOf===s)return a.indexOf(b);for(d=0,e=a.length;d<e;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b){if(a==null)return-1;if(t&&a.lastIndexOf===t)return a.lastIndexOf(b);var c=a.length;while(c--)if(a[c]===b)return c;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=Array(d);while(e<d)f[e++]=a,a+=c;return f},x.bind=function(a,b){if(a.bind===w&&w)return w.apply(a,h.call(arguments,1));var c=h.call(arguments,2);return function(){return a.apply(b,c.concat(h.call(arguments)))}},x.bindAll=function(a){var b=h.call(arguments,1);b.length==0&&(b=x.functions(a)),y(b,function(b){a[b]=x.bind(a[b],a)});return a},x.memoize=function(a,b){var c={};b||(b=x.identity);return function(){var d=b.apply(this,arguments);return k.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))};var A=function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,a.apply(e,f)};c&&clearTimeout(d);if(c||!d)d=setTimeout(g,b)}};x.throttle=function(a,b){return A(a,b,!1)},x.debounce=function(a,b){return A(a,b,!0)},x.once=function(a){var b=!1,c;return function(){if(b)return c;b=!0;return c=a.apply(this,arguments)}},x.wrap=function(a,b){return function(){var c=[a].concat(h.call(arguments));return b.apply(this,c)}},x.compose=function(){var a=h.call(arguments);return function(){var b=h.call(arguments);for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){if(--a<1)return b.apply(this,arguments)}},x.keys=v||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)k.call(a,c)&&(b[b.length]=c);return b},x.values=function(a){return x.map(a,x.identity)},x.functions=x.methods=function(a){return x.filter(x.keys(a),function(b){return x.isFunction(a[b])}).sort()},x.extend=function(a){y(h.call(arguments,1),function(b){for(var c in b)b[c]!==void 0&&(a[c]=b[c])});return a},x.defaults=function(a){y(h.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])});return a},x.clone=function(a){return x.isArray(a)?a.slice():x.extend({},a)},x.tap=function(a,b){b(a);return a},x.isEqual=function(a,b){if(a===b)return!0;var c=typeof a,d=typeof b;if(c!=d)return!1;if(a==b)return!0;if(!a&&b||a&&!b)return!1;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(a.isEqual)return a.isEqual(b);if(x.isDate(a)&&x.isDate(b))return a.getTime()===b.getTime();if(x.isNaN(a)&&x.isNaN(b))return!1;if(x.isRegExp(a)&&x.isRegExp(b))return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;if(c!=="object")return!1;if(a.length&&a.length!==b.length)return!1;var e=x.keys(a),f=x.keys(b);if(e.length!=f.length)return!1;for(var g in a)if(!(g in b)||!x.isEqual(a[g],b[g]))return!1;return!0},x.isEmpty=function(a){if(x.isArray(a)||x.isString(a))return a.length===0;for(var b in a)if(k.call(a,b))return!1;return!0},x.isElement=function(a){return!!a&&a.nodeType==1},x.isArray=u||function(a){return j.call(a)==="[object Array]"},x.isArguments=function(a){return!!a&&!!k.call(a,"callee")},x.isFunction=function(a){return!!(a&&a.constructor&&a.call&&a.apply)},x.isString=function(a){return!!(a===""||a&&a.charCodeAt&&a.substr)},x.isNumber=function(a){return!!(a===0||a&&a.toExponential&&a.toFixed)},x.isNaN=function(a){return a!==a},x.isBoolean=function(a){return a===!0||a===!1},x.isDate=function(a){return!!(a&&a.getTimezoneOffset&&a.setUTCFullYear)},x.isRegExp=function(a){return!(!(a&&a.test&&a.exec)||!a.ignoreCase&&a.ignoreCase!==!1)},x.isNull=function(a){return a===null},x.isUndefined=function(a){return a===void 0},x.noConflict=function(){b._=c;return this},x.identity=function(a){return a},x.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},x.mixin=function(a){y(x.functions(a),function(b){E(b,x[b]=a[b])})};var B=0;x.uniqueId=function(a){var b=B++;return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},x.template=function(a,b){var c=x.templateSettings,d="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.interpolate,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(c.evaluate||null,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",e=new Function("obj",d);return b?e(b):e};var C=function(a){this._wrapped=a};x.prototype=C.prototype;var D=function(a,b){return b?x(a).chain():a},E=function(a,b){C.prototype[a]=function(){var a=h.call(arguments);i.call(a,this._wrapped);return D(b.apply(x,a),this._chain)}};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=e[a];C.prototype[a]=function(){b.apply(this._wrapped,arguments);return D(this._wrapped,this._chain)}}),y(["concat","join","slice"],function(a){var b=e[a];C.prototype[a]=function(){return D(b.apply(this._wrapped,arguments),this._chain)}}),C.prototype.chain=function(){this._chain=!0;return this},C.prototype.value=function(){return this._wrapped}})()}).call(a.exports),_browserifyRequire.modules.underscore._cached=a.exports;return a.exports},[].forEach(function(a){_browserifyRequire.modules[a]=_browserifyRequire.modules.underscore}),_browserifyRequire.modules["underscore/index"]=function(){var a={exports:{}},b=a.exports,c="underscore",d="underscore/underscore/index",e=function(a){return _browserifyRequire.fromFile("underscore/index",a)};(function(){a.exports=e("./underscore")}).call(a.exports),_browserifyRequire.modules["underscore/index"]._cached=a.exports;return a.exports},[].forEach(function(a){_browserifyRequire.modules[a]=_browserifyRequire.modules["underscore/index"]}),_browserifyRequire.modules["brain/bayesian/backends/localStorage"]=function(){var a={exports:{}},b=a.exports,c="brain",d="brain/localStorage.js",e=function(a){return _browserifyRequire.fromFile("brain/bayesian/backends/localStorage",a)};(function(){var a=e("underscore")._,c=function(a){var a=a||{},b=a.name||Math.floor(Math.random()*1e5);this.prefix="brain.bayesian."+b,a.testing&&(localStorage={}),localStorage[this.prefix+".cats"]="{}"};c.prototype={async:!1,getCats:function(){return JSON.parse(localStorage[this.prefix+".cats"])},setCats:function(a){localStorage[this.prefix+".cats"]=JSON.stringify(a)},getWordCount:function(a){return JSON.parse(localStorage[this.prefix+".words."+a]||"{}")},setWordCount:function(a,b){localStorage[this.prefix+".words."+a]=JSON.stringify(b)},getWordCounts:function(a){var b={};a.forEach(function(a){b[a]=this.getWordCount(a)},this);return b},incCounts:function(b,c){var d=this.getCats();a(b).each(function(a,b){d[b]=d[b]+a||a},this),this.setCats(d),a(c).each(function(b,c){var d=this.getWordCount(c);a(b).each(function(a,b){d[b]=d[b]+a||a},this),this.setWordCount(c,d)},this)},toJSON:function(){var a={},b=new RegExp("^"+this.prefix+".words.(.+)$");for(item in localStorage){var c=b.exec(item);c&&(a[c[1]]=JSON.parse(localStorage[item]))}return{cats:JSON.parse(localStorage[this.prefix+".cats"]),words:a}},fromJSON:function(a){this.incCounts(a.cats,a.words)}},b.LocalStorageBackend=c}).call(a.exports),_browserifyRequire.modules["brain/bayesian/backends/localStorage"]._cached=a.exports;return a.exports},[].forEach(function(a){_browserifyRequire.modules[a]=_browserifyRequire.modules["brain/bayesian/backends/localStorage"]}),_browserifyRequire.modules["brain/bayesian/backends/memory"]=function(){var a={exports:{}},b=a.exports,c="brain",d="brain/memory.js",e=function(a){return _browserifyRequire.fromFile("brain/bayesian/backends/memory",a)};(function(){var a=e("underscore")._,c=function(){this.catCounts={},this.wordCounts={}};c.prototype={async:!1,incCounts:function(b,c){a(b).each(function(a,b){this.catCounts[b]=this.catCounts[b]+a||a},this),a(c).each(function(b,c){this.wordCounts[c]=this.wordCounts[c]||{},a(b).each(function(a,b){this.wordCounts[c][b]=this.wordCounts[c][b]+a||a},this)},this)},getCats:function(){return this.catCounts},getWordCounts:function(a,b){return this.wordCounts},toJSON:function(){return{cats:this.catCounts,words:this.wordCounts}},fromJSON:function(a){this.catCounts=a.cats,this.wordCounts=a.words}},b.MemoryBackend=c}).call(a.exports),_browserifyRequire.modules["brain/bayesian/backends/memory"]._cached=a.exports;return a.exports},[].forEach(function(a){_browserifyRequire.modules[a]=_browserifyRequire.modules["brain/bayesian/backends/memory"]}),_browserifyRequire.modules["brain/bayesian/backends/redis"]=function(){var a={exports:{}},b=a.exports,c="brain",d="brain/redis.js",e=function(a){return _browserifyRequire.fromFile("brain/bayesian/backends/redis",a)};(function(){var a=e("redis"),c=e("underscore")._,d=function(b){b=b||{};var c=b.port||6379,d=b.hostname||"localhost",e=b.options||{};this.client=function(){var f=a.createClient(c,d,e);b.error&&f.on("error",b.error);return f};var f=b.name||Math.floor(Math.random()*1e5);this.catsKey="brain_bayes_cats_"+f,this.wordsKey="brain_bayes_words_"+f,b.db&&this.client().select(b.db)};d.prototype={async:!0,key:function(a,b){return a+"____"+b},pair:function(a){return/(.*)____(.*)/.exec(a).slice(1)},incCounts:function(a,b,d){var e=this.client(),f=e.multi();c(a).each(function(a,b){f.hincrby(this.catsKey,b,a)},this),c(b).each(function(a,b){c(a).each(function(a,c){f.hincrby(this.wordsKey,this.key(b,c),a)},this)},this);var g=this;f.exec(function(a,b){d&&d(b),e.quit()})},getCats:function(a){var b=this,d=this.client();d.hgetall(this.catsKey,function(b,e){c(e).each(function(a,b){e[b]=parseInt(a)}),a(e),d.quit()})},getWordCounts:function(a,b,d){var e=c(a).reduce(function(a,d){return a.concat(c(b).map(function(a,b){return this.key(d,b)},this))},[],this),f=this,g=[this.wordsKey].concat(e),h=this.client();h.hmget(g,function(a,b){var c={};e.map(function(a,d){var e=f.pair(a),g=e[0],h=e[1];c[g]=c[g]?c[g]:{},c[g][h]=parseInt(b[d])||0}),d(c),h.quit()})},toJSON:function(a){var b=this;this.getCats(function(c){var d=b.client();d.hgetall(b.wordsKey,function(e,f){var g={};for(key in f){var h=b.pair(key),i=h[0],j=h[1];g[i]=g[i]?g[i]:{},g[i][j]=parseInt(f[key])||0}a({cats:c,words:g}),d.quit()})})},fromJSON:function(a,b){this.incCounts(a.cats,a.words,b)}},b.RedisBackend=d}).call(a.exports),_browserifyRequire.modules["brain/bayesian/backends/redis"]._cached=a.exports;return a.exports},[].forEach(function(a){_browserifyRequire.modules[a]=_browserifyRequire.modules["brain/bayesian/backends/redis"]}),_browserifyRequire.modules["brain/bayesian/bayesian"]=function(){var a={exports:{}},b=a.exports,c="brain",d="brain/bayesian.js",e=function(a){return _browserifyRequire.fromFile("brain/bayesian/bayesian",a)};(function(){var a=e("underscore")._,c=function(a){a=a||{},this.thresholds=a.thresholds||{},this.def=a.def||"unclassified",this.weight=a.weight||1,this.assumed=a.assumed||.5;var b=a.backend||{type:"memory"};switch(b.type.toLowerCase()){case"redis":this.backend=new(e("./backends/redis").RedisBackend)(b.options);break;case"localstorage":this.backend=new(e("./backends/localStorage").LocalStorageBackend)(b.options);break;default:this.backend=new(e("./backends/memory").MemoryBackend)}};c.prototype={getCats:function(a){return this.backend.getCats(a)},getWordCounts:function(a,b,c){return this.backend.getWordCounts(a,b,c)},incDocCounts:function(a,b){var c={},d={};a.forEach(function(a){var b=a.cat;d[b]=d[b]?d[b]+1:1;var e=this.getWords(a.doc);e.forEach(function(a){c[a]=c[a]||{},c[a][b]=c[a][b]?c[a][b]+1:1},this)},this);return this.backend.incCounts(d,c,b)},setThresholds:function(a){this.thresholds=a},getWords:function(b){if(a(b).isArray())return b;var c=b.split(/\W+/);return a(c).uniq()},train:function(a,b,c){this.incDocCounts([{doc:a,cat:b}],function(a,b){c&&c(b)})},trainAll:function(a,b){a=a.map(function(a){return{doc:a.input,cat:a.output}}),this.incDocCounts(a,function(a,c){b&&b(c)})},wordProb:function(b,c,d,e){var f=(e[c]||0)/d[c],g=a(d).reduce(function(a,b,c){return a+(e[c]||0)},0,this);return(this.weight*this.assumed+g*f)/(this.weight+g)},getCatProbs:function(b,c,d){var e=a(b).reduce(function(a,b){return a+b},0),f={};a(b).each(function(g,h){var i=(g||0)/e,j=a(c).reduce(function(a,c){var e=d[c]||{};return a*this.wordProb(c,h,b,e)},1,this);f[h]=i*j},this);return f},getProbs:function(a,b){var c=this;this.getCats(function(d){var e=c.getWords(a);c.getWordCounts(e,d,function(a){var f=c.getCatProbs(d,e,a);b(f)})})},getProbsSync:function(a){var b=this.getWords(a),c=this.getCats(),d=this.getWordCounts(b,c);return this.getCatProbs(c,b,d)},bestMatch:function(b){var c=a(b).reduce(function(a,b,c){return a.prob>b?a:{cat:c,prob:b}},{prob:0}),d=c.cat||this.def,e=this.thresholds[c.cat]||1;a(b).map(function(a,b){b!=c.cat&&a*e>c.prob&&(d=this.def)},this);return d},classify:function(a,b){if(!this.backend.async)return this.classifySync(a);var c=this;this.getProbs(a,function(a){b(c.bestMatch(a))})},classifySync:function(a){var b=this.getProbsSync(a);return this.bestMatch(b)},test:function(a){var b=0;a.forEach(function(a){var c=this.classify(a.input);b+=c==a.output?0:1},this);return b/a.length},toJSON:function(a){return this.backend.toJSON(a)},fromJSON:function(a,b){this.backend.fromJSON(a,b);return this}},b.BayesianClassifier=c}).call(a.exports),_browserifyRequire.modules["brain/bayesian/bayesian"]._cached=a.exports;return a.exports},[].forEach(function(a){_browserifyRequire.modules[a]=_browserifyRequire.modules["brain/bayesian/bayesian"]}),_browserifyRequire.modules.brain=function(){var a={exports:{}},b=a.exports,c="brain",d="brain/brain.js",e=function(a){return _browserifyRequire.fromFile("brain",a)};(function(){b.NeuralNetwork=e("./neuralnetwork").NeuralNetwork,b.crossValidate=e("./crossvalidate").crossValidate,b.BayesianClassifier=e("./bayesian/bayesian").BayesianClassifier}).call(a.exports),_browserifyRequire.modules.brain._cached=a.exports;return a.exports},["brain/brain","brain"].forEach(function(a){_browserifyRequire.modules[a]=_browserifyRequire.modules.brain}),_browserifyRequire.modules["brain/crossvalidate"]=function(){var a={exports:{}},b=a.exports,c="brain",d="brain/crossvalidate.js",e=function(a){return _browserifyRequire.fromFile("brain/crossvalidate",a)};(function(){function c(a,b,c,d){var e=new a(b),f=Date.now();e.trainAll(c);var g=Date.now(),h=e.test(d),i=Date.now();return{error:h,trainTime:g-f,testTime:i-g,trainSize:c.length,testSize:d.length}}var a=e("underscore")._;b.crossValidate=function(b,d,e,f){var g=e.length/f,h=a.range(f).map(function(b){var c=a(e).clone();return[c.splice(b*g,g),c]}),i=a(h).map(function(a,e){return c(b,d,a[1],a[0])});return i}}).call(a.exports),_browserifyRequire.modules["brain/crossvalidate"]._cached=a.exports;return a.exports},[].forEach(function(a){_browserifyRequire.modules[a]=_browserifyRequire.modules["brain/crossvalidate"]}),_browserifyRequire.modules["brain/neuralnetwork"]=function(){var a={exports:{}},b=a.exports,c="brain",d="brain/neuralnetwork.js",e=function(a){return _browserifyRequire.fromFile("brain/neuralnetwork",a)};(function(){function d(a,b,c){this.layer=a,this.id=b,this.output=0;if(c)this.fromJSON(c);else if(this.layer.prevLayer){this.weights={},this.change={};for(var b in this.getIncoming())this.addIncoming(b);this.bias=this.randomWeight()}}function c(a,b,c,d){this.network=a,this.prevLayer=b,this.prevLayer&&(this.prevLayer.nextLayer=this),this.nodes={};if(d)this.fromJSON(d);else if(c)for(var e=0;e<c;e++)this.createNode(e)}var a=function(a){a=a||{},this.learningRate=a.learningRate||.5,this.growthRate=a.growthRate||.5,this.momentum=a.momentum||.1,this.createLayers(a.hidden)};a.prototype={createLayers:function(a,b){var d=3;a?d=a.length+2:b&&(d=b.layers.length),this.layers=[];for(var e=0;e<d;e++){var f=a?a[e-1]:0,g=b?b.layers[e]:null,h=new c(this,h,f,g);this.layers.push(h)}this.inputLayer=this.layers[0],this.outputLayer=this.layers[d-1],!a&&!b?this.hiddenLayer=this.layers[1]:this.hiddenLayer=null},run:function(a){this.inputLayer.createNodes(a),this.hiddenLayer&&this.hiddenLayer.growLayer(this.inputLayer.getSize()),this.inputLayer.setOutputs(a);for(var b=1;b<this.layers.length;b++)this.layers[b].calcOutputs();var c=this.outputLayer.getOutputs();return this.formatOutput(c)},trainItem:function(a,b){this.outputLayer.createNodes(b),this.run(a),this.outputLayer.calcErrors(b);for(var c=this.layers.length-2;c>=0;c--)this.layers[c].calcErrors();for(var c=1;c<this.layers.length;c++)this.layers[c].adjustWeights();return this.outputLayer.getError()},train:function(a,b,c,d,e){b=b||2e4,c=c||.007;var f=1;for(var g=0;g<b&&f>c;g++){var h=0;for(var i=0;i<a.length;i++){var j=this.trainItem(a[i].input,a[i].output);h+=Math.pow(j,2)}f=Math.sqrt(h)/a.length,d&&g%e==0&&d({error:f,iterations:g})}return{error:f,iterations:g}},trainAll:function(a){this.train(a)},getError:function(a,b){var c=0,d=0;for(var e in a)c+=Math.pow(a[e]-b[e],2),d++;return c/d},test:function(a){var b=0;for(var c=0;c<a.length;c++){var d=this.run(a[c].input);b+=this.getError(d,a[c].output)}return b/a.length},formatOutput:function(a){var b=[];for(var c in a){if(parseInt(c)!=c)return a;b.push(a[c])}return b},toJSON:function(){var a={layers:[]};for(var b=0;b<this.layers.length;b++)a.layers.push(this.layers[b].toJSON());return a},fromJSON:function(a){this.createLayers(null,a);return this},toFunction:function(){var a=this.toJSON();return new Function("inputs","  var net = "+JSON.stringify(a)+";\n\n\n  for(var i = 1; i < net.layers.length; i++) {\n\n    var nodes = net.layers[i].nodes;\n\n    var outputs = {};\n\n    for(var id in nodes) {\n\n      var node = nodes[id];\n\n      var sum = node.bias;\n\n      for(var iid in node.weights)\n\n        sum += node.weights[iid] * inputs[iid];\n\n      outputs[id] = (1/(1 + Math.exp(-sum)));\n\n    }\n\n    inputs = outputs;\n\n  }\n\n  return outputs;")},toString:function(){return JSON.stringify(this.toJSON())}},c.prototype={getOutputs:function(){return this.map(function(a){return a.output})},setOutputs:function(a){this.map(function(b,c){b.output=a[c]||0})},getError:function(){var a=this.reduce(function(a,b){return a+Math.pow(b.error,2)},0);return Math.sqrt(a)/this.getSize()},getSize:function(){return this.reduce(function(a){return++a},0)},map:function(a){var b={};for(var c in this.nodes)b[c]=a(this.nodes[c],c);return b},reduce:function(a,b){for(var c in this.nodes)b=a(b,this.nodes[c]);return b},growLayer:function(a){var b=a;a>5&&(b*=this.network.growthRate);for(var c=this.getSize();c<b;c++)this.createNode(c)},createNodes:function(a){for(var b in a)this.nodes[b]||this.createNode(b)},createNode:function(a){var b=new d(this,a);this.nodes[a]=b;if(this.nextLayer){var c=this.nextLayer.nodes;for(var e in c)c[e].addIncoming(a)}},calcOutputs:function(){for(var a in this.nodes)this.nodes[a].calcOutput()},calcErrors:function(a){for(var b in this.nodes)this.nodes[b].calcError(a)},adjustWeights:function(){for(var a in this.nodes)this.nodes[a].adjustWeights()},toJSON:function(){var a={nodes:{}};for(var b in this.nodes)a.nodes[b]=this.nodes[b].toJSON();return a},fromJSON:function(a){this.nodes={};for(var b in a.nodes)this.nodes[b]=new d(this,b,a.nodes[b])}},d.prototype={getIncoming:function(){return this.layer.prevLayer.nodes},getOutgoing:function(){return this.layer.nextLayer.nodes},randomWeight:function(){return Math.random()*.4-.2},sigmoid:function(a){return 1/(1+Math.exp(-a))},dsigmoid:function(a){return a*(1-a)},addIncoming:function(a){this.weights[a]=this.randomWeight(),this.change[a]=0},calcOutput:function(){var a=this.bias,b=this.getIncoming();for(var c in this.weights)a+=this.weights[c]*b[c].output;this.output=this.sigmoid(a)},calcError:function(a){if(a){var b=a[this.id]||0;this.error=b-this.output}else{this.error=0;var c=this.getOutgoing();for(var d in c)this.error+=c[d].delta*c[d].weights[this.id]}this.delta=this.error*this.dsigmoid(this.output)},adjustWeights:function(){var a=this.layer.network.learningRate,b=this.layer.network.momentum,c=this.getIncoming();for(var d in c){var e=a*this.delta*c[d].output+b*this.change[d];this.change[d]=e,this.weights[d]+=e}this.bias+=a*this.delta},toJSON:function(){return{weights:this.weights,bias:this.bias}},fromJSON:function(a){this.weights=a.weights,this.bias=a.bias}},b.NeuralNetwork=a}).call(a.exports),_browserifyRequire.modules["brain/neuralnetwork"]._cached=a.exports;return a.exports},[].forEach(function(a){_browserifyRequire.modules[a]=_browserifyRequire.modules["brain/neuralnetwork"]});return require("brain")}()